<!DOCTYPE HTML><html>
<head>
  <title>Enable X Slice Cafe Digital Oven</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/x-icon" href="./pictures/Reach.png">
  <link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>
  <div class="topnav">
    <img class ="reachlogo"src = "./pictures/Reach.png"/>
    <h1 class="topnav-name">Enable X Slice Cafe Digital Oven</h1>
  </div>
  <div class="wholeApp">  
    <div class="content">
      <div class="card" id="content">
        <h2 class="statusstate">Status</h2>
        <p class="state state-function">Function: NIL</p>
        <p class="state state-temperature">Temperature(<sup>o</sup>C): NIL</p>
        <p class="state state-duration">Duration(mins): NIL</p>
      </div>
      <div>

      </div>
      <div class="buttons">
          <div class="firstSet" id="firstSet" onclick="selectfirst()">
              <div class="buttonInner grill-box">
                <!-- slider stuff -->
                <div class="iconWithDescription">
                  <img class="grill" src="./pictures/grill.png"/>
                  <p class="titles grillTitle" id="firstTitle">Grill</p>
                </div>
                  <div class="slidersandduration">
                    <div class="slidercontainter">
                      <input type="range" min="30" max="230" value=%defaultT1% class="slider" id="grillTemperatureSlider" />
                      <p class="settings">Temperature: <span class="settings" id="grillTemp"></span><span class="settings"><sup>o</sup>C </span></p>
                    </div>
                    <div class="slidercontainter durationSliderContainer">
                      <input type="range" min="1" max="120" value=%defaultD1% class="slider" id="grillDurationSlider" />
                      <p class="settings">Duration: <span class="settings" id="grillDuration"></span><span class="settings"> Mins</span></p>
                    </div>
                  </div>
                  <div class="information-wrapper">
                    <img src="./pictures/filled.svg" class="information-icon" />
                    <div class="information-tooltip">
                      <p>Temperature: <span>%defaultT1%</span><sup>o</sup>C</p>
                      <p>Duration: <span>%defaultD1%</span>mins</p>
                    </div>
                  </div>
            </div>
        </div>
          <div class="secondSet" id="secondSet" onclick="selectsecond()">
            <div class="second">
                <div class="buttonInner">
                  <div class="iconWithDescription">
                    <img class="baking" src="./pictures/baking.png"/>
                    <p class="titles bakeTitles" id="secondTitle">Bake</p>
                  </div>
                  <div class="slidersandduration">
                    <!-- <h2 class="descriptions" id="firstTemperature"></h2> -->
                    <div class="slidercontainer">
                      <input type="range" min="30" max="230" value=%defaultT2% class="slider" id="bakeTemperatureSlider"/>
                      <p class="settings">Temperature: <span class="settings" id="bakeTemp"></span><span class="settings"><sup>o</sup>C </span></p>
                    </div>
                    <p class="descriptions" id="secondDuration"></p>
                    <div class="slidercontainter durationSliderContainer secondDurationSlider">
                      <input type="range" min="10" max="120" value=%defaultD2% class="slider" id="bakeDurationSlider"/>
                      <p class="settings">Duration: <span class="settings" id="bakeDuration"></span><span class="settings"> Mins</span></p>
                    </div>
                  </div>
                  <div class="information-wrapper">
                    <img src="./pictures/filled.svg" class="information-icon" />
                    <div class="information-tooltip">
                      <p>Temperature: <span>%defaultT2%</span><sup>o</sup>C</p>
                      <p>Duration: <span>%defaultD2%</span>mins</p>
                    </div>
                  </div>
                </div>
            </div>
          </div> 
          <div class="thirdSet" id ="thirdSet" onclick="selectthird()">
            <div class="third">
              <div class="buttonInner">
                <div class="iconWithDescription">
                  <img  class="rotisserie" src="./pictures/rotisserie.png"/>
                  <p class="titles thirdTitle" id="thirdTitle">Rotisserie </p>
                </div>
                <div class="slidersandduration">
                  <!-- <h2 class="descriptions" id="firstTemperature"></h2> -->
                  <div class="slidercontainer">
                    <input type="range" min="30" max="230" value=%defaultT3% class="slider" id="rotiTemperatureSlider"/>
                    <p class="settings">Temperature: <span class="settings" id="rotiTemp"></span><span class="settings"><sup>o</sup>C </span></p>
                  </div>
                  <p class="descriptions" id="thirdduration"></p>
                  <div class="slidercontainter durationSliderContainer thirdDurationSlider">
                    <input type="range" min="10" max="120" value=%defaultD3% class="slider" id="rotiDurationSlider"/>
                    <p class="settings">Duration: <span class="settings" id="rotiDuration"></span><span class="settings"> Mins</span></p>
                  </div>
                </div>
                <div class="information-wrapper">
                  <img src="./pictures/filled.svg" class="information-icon" />
                  <div class="information-tooltip">
                    <p>Temperature: <span>%defaultT3%</span><sup>o</sup>C</p>
                    <p>Duration: <span>%defaultD3%</span>mins</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
      </div>
    </div>
    <div class="bottomnav" id="defaultbottomnav">
        <div class="leftside" onclick="homebutton()">
          <div class="homebutton">
            <svg class="homebuttonicon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6">
              <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 12l8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25" />
            </svg>
            <span class="home">Operate Oven</span>        
          </div>
        </div>
      <div class="border">
    </div>
      <div class="rightside" onclick="settingsbutton()">
        <div class="settingsbutton">
          <svg class="settingsbuttonicon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6">
            <path stroke-linecap="round" stroke-linejoin="round" d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.324.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 011.37.49l1.296 2.247a1.125 1.125 0 01-.26 1.431l-1.003.827c-.293.24-.438.613-.431.992a6.759 6.759 0 010 .255c-.007.378.138.75.43.99l1.005.828c.424.35.534.954.26 1.43l-1.298 2.247a1.125 1.125 0 01-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.57 6.57 0 01-.22.128c-.331.183-.581.495-.644.869l-.213 1.28c-.09.543-.56.941-1.11.941h-2.594c-.55 0-1.02-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 01-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 01-1.369-.49l-1.297-2.247a1.125 1.125 0 01.26-1.431l1.004-.827c.292-.24.437-.613.43-.992a6.932 6.932 0 010-.255c.007-.378-.138-.75-.43-.99l-1.004-.828a1.125 1.125 0 01-.26-1.43l1.297-2.247a1.125 1.125 0 011.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.087.22-.128.332-.183.582-.495.644-.869l.214-1.281z" />
            <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
          </svg>
          <span class="Settings">Configure Settings</span>      
        </div>     
      </div>
    </div>

  </div>
<script>
  function adjustSlider(sliderId, sliderOuter, tooltipId, tooltipItemId){
    let slider = document.getElementById(sliderId);
    let output = document.getElementById(sliderOuter);
    const tooltips = document.getElementsByClassName("information-tooltip");
    const tooltipItem = tooltips[tooltipId].children[tooltipItemId].children[0];
    tooltipItem.innerHTML = slider.value;
    output.innerHTML = slider.value;
    slider.oninput = function() {
      output.innerHTML = this.value;
      tooltipItem.innerHTML = slider.value;
    }
  }
  let onSettings = false;
  adjustSlider("grillTemperatureSlider","grillTemp", 0, 0);
  adjustSlider("grillDurationSlider","grillDuration", 0, 1);
  adjustSlider("bakeTemperatureSlider","bakeTemp", 1, 0);
  adjustSlider("bakeDurationSlider","bakeDuration", 1, 1);
  adjustSlider("rotiTemperatureSlider","rotiTemp", 2, 0);
  adjustSlider("rotiDurationSlider","rotiDuration", 2, 1);

  let defaultNavbar = document.getElementById("defaultbottomnav");
  let functionnames ={1:"Grill", 2:"Bake", 3:"Rotisserie"};

  var gateway = `ws://${window.location.hostname}/ws`; //gets the webserver IP address
  var websocket;
  let temperatureInput1 = true;
  let temperatureInput2 = true;
  let temperatureInput3 = true;
  let temperatureInput4 = true;
  let temperature = "0";
  let duration = "0";
  let maxTemp= "0";
  let maxDuration= "0";
  let selectedFunction=0;
  window.addEventListener('load', onLoad); //adds listeners to it
  function initWebSocket() {
    console.log('Trying to open a WebSocket connection...');
    websocket = new WebSocket(gateway);
    websocket.onopen    = onOpen;
    websocket.onclose   = onClose;
    websocket.onmessage = onMessage; 
  }
  function onOpen(event) {
    console.log('Connection opened');
  }
  function onClose(event) {
    console.log('Connection closed');
    setTimeout(initWebSocket, 2000);
  }
  function onMessage(event) { //Handles incoming message from the server (esp32 board)
    var state;
    let data = event.data.split(",");
    console.log(data);
    temperature = data[1];
    duration = data[3];
    maxTemp= data[5];
    maxDuration= data[7];
    selectedFunction=parseInt(data[9]);

    initButton(selectedFunction);

    if (selectedFunction === 0) {
      document.getElementsByClassName("state-function")[0].innerHTML = `Function: RESET`;
      document.getElementsByClassName("state-temperature")[0].innerHTML = `Temp(<sup>o</sup>C): RESET`;
      document.getElementsByClassName("state-duration")[0].innerHTML = `Duration(mins): RESET`;
      resetall();
    } else {
      document.getElementsByClassName("state-function")[0].innerHTML = `Function: ${functionnames[selectedFunction]}`;
      document.getElementsByClassName("state-temperature")[0].innerHTML = `Temp(<sup>o</sup>C): ${temperature}/${maxTemp}`;
      document.getElementsByClassName("state-duration")[0].innerHTML = `Duration(mins): ${duration}/${maxDuration}`;
    }
    
  }
  function onLoad(event) {
    initWebSocket();
    // initButton();
  }

  function initButton(functionID) {
    let box1 = document.getElementById("firstSet");
    let box2 = document.getElementById("secondSet");
    let box3 = document.getElementById("thirdSet");

    if (functionID === 1) {
      let box1 = document.getElementById("firstSet");
      box1.style.backgroundColor="green";
      box2.style.backgroundColor="#A668A6";
      box3.style.backgroundColor="#F7A4A4";
    } else if (functionID === 2) {
      let box2 = document.getElementById("secondSet");
      box2.style.backgroundColor="green";
      box1.style.backgroundColor="#FFB52E";
      box3.style.backgroundColor="#F7A4A4";
    } else if (functionID === 3) {
      let box3 = document.getElementById("thirdSet");
      box3.style.backgroundColor="green";
      box1.style.backgroundColor="#FFB52E";
      box2.style.backgroundColor="#A668A6";
    }
  }

  function toggleSave() {
    const sliders = document.getElementsByClassName("slider");
    websocket.send(`save,${sliders[0].value}\n${sliders[1].value}\n${sliders[2].value}\n${sliders[3].value}\n${sliders[4].value}\n${sliders[5].value}`);
  }

  function homebutton(){
    let sliders = document.getElementsByClassName("slidersandduration");
    for (const slider of sliders) {
      slider.style.display="none"
    }
    onSettings=true;
    toggleSave();
  }
  
  function settingsbutton(){
    let sliders = document.getElementsByClassName("slidersandduration");
      for (const slider of sliders) {
        slider.style.display="block"
      }
      onSettings=true;
      resetall();
  }

// Reset all styles
function resetall(){
  let box1 = document.getElementById("firstSet");
  let box2 = document.getElementById("secondSet");
  let box3 = document.getElementById("thirdSet");
  box1.style.backgroundColor="#FFB52E";
  box2.style.backgroundColor="#A668A6";
  box3.style.backgroundColor="#F7A4A4";
} 


function selectfirst(){
  const tempSlider = document.getElementsByClassName("slider")[0];
  const durationSlider = document.getElementsByClassName("slider")[1];
  // let tempSliderDisplay = window.getComputedStyle(tempSlider,null).display;
  let firstCheck = document.getElementsByClassName("slidersandduration")[0];
  let check= window.getComputedStyle(firstCheck,null).display;
  if(check == "block"){ // check whether on settings page
    return;
  }
  let x = document.getElementById("firstSet");
  let y=window.getComputedStyle(x);
  let z = y.getPropertyValue("background-color");
  if(z === "rgb(255, 181, 46)"){
    resetall();
    x.style.backgroundColor="green";
    const temperature = tempSlider.value;
    const duration = durationSlider.value;
    console.log("function,1," + temperature + "," + duration);
    websocket.send("function,1," + temperature + "," + duration);
  } else {
    resetfunction();
  }
}
function selectsecond(){
  const tempSlider = document.getElementsByClassName("slider")[2];
  const durationSlider = document.getElementsByClassName("slider")[3];
  let secondCheck = document.getElementsByClassName("slidersandduration")[1];
  let check = window.getComputedStyle(secondCheck,null).display;
  if(check == "block"){
    return;
  }
  let x = document.getElementById("secondSet");
  let y=window.getComputedStyle(x);
  let z = y.getPropertyValue("background-color");
  if(z === "rgb(166, 104, 166)"){
    resetall();
    x.style.backgroundColor="green";
    const temperature = tempSlider.value;
    const duration = durationSlider.value;
    console.log("function,2," + temperature + "," + duration);
    websocket.send("function,2," + temperature + "," + duration);
  } else{
    // resetall();
    resetfunction();
  }
}
function selectthird(){
  const tempSlider = document.getElementsByClassName("slider")[4];
  const durationSlider = document.getElementsByClassName("slider")[5];
  // let check = window.getComputedStyle(tempSlider,null).display;
  let thirdCheck = document.getElementsByClassName("slidersandduration")[2];
  let check = window.getComputedStyle(thirdCheck,null).display
  if(check == "block"){
    return;
  }
  let x = document.getElementById("thirdSet");
  let y=window.getComputedStyle(x);
  let z = y.getPropertyValue("background-color");
  if(z === "rgb(247, 164, 164)"){
    resetall();
    x.style.backgroundColor="green";
    const temperature = tempSlider.value;
    const duration = durationSlider.value;
    console.log("function,3," + temperature + "," + duration);
    websocket.send("function,3," + temperature + "," + duration);
  } else {
    // resetall();
    resetfunction();
  }
}
function resetfunction(){
  try {
    websocket.send("reset");
  } catch (error) {
    console.error(error);
  }
  resetall();

  // defaultNavbar.style.display="flex";
  // thirdNavbar.style.display="none";
  document.getElementsByClassName("state-function")[0].innerHTML = `Function: RESET`;
  document.getElementsByClassName("state-temperature")[0].innerHTML = `Temp(<sup>o</sup>C): RESET`;
  document.getElementsByClassName("state-duration")[0].innerHTML = `Duration(mins): RESET`;
  temperature = "0";
  duration = "0";
  maxTemp = "0";
  maxDuration = "0";
  selectedFunction=0;
}


</script>
</body>
</html>
